/* ===========================
   Carousel
=========================== */
const slides = document.querySelectorAll(".carousel-slides img");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const dotsContainer = document.getElementById("dots");

let currentIndex = 0;

function showSlide(index) {
    slides.forEach((slide, i) => {
        slide.style.display = i === index ? "block" : "none";
    });
    updateDots(index);
}

function updateDots(index) {
    const dots = dotsContainer.querySelectorAll("button");
    dots.forEach(dot => dot.classList.remove("active"));
    if (dots[index]) dots[index].classList.add("active");
}

prevBtn.addEventListener("click", () => {
    currentIndex = (currentIndex - 1 + slides.length) % slides.length;
    showSlide(currentIndex);
});

nextBtn.addEventListener("click", () => {
    currentIndex = (currentIndex + 1) % slides.length;
    showSlide(currentIndex);
});

// Generate dots
slides.forEach((_, idx) => {
    const btn = document.createElement("button");
    btn.addEventListener("click", () => {
        currentIndex = idx;
        showSlide(currentIndex);
    });
    dotsContainer.appendChild(btn);
});

// Initialize carousel
showSlide(currentIndex);

/* ===========================
   Staff password protection
=========================== */
const PASSWORD = 'MPWEC!';
const lockedEl = document.getElementById('locked');
const staffPanel = document.getElementById('staffPanel');
const unlockBtn = document.getElementById('unlockBtn');
const pwdInput = document.getElementById('staffPassword');

if (unlockBtn && pwdInput) {
    function unlock() {
        const val = (pwdInput.value || '').trim();
        if (val === PASSWORD) {
            lockedEl.style.display = 'none';
            staffPanel.style.display = 'block';
            lockedEl.setAttribute('aria-hidden', 'true');
            staffPanel.setAttribute('aria-hidden', 'false');
            document.getElementById('staff-name').focus();
        } else {
            pwdInput.value = '';
            pwdInput.focus();
            alert('Incorrect password. If you need access, please contact Michelle or Zoe.');
        }
    }
    unlockBtn.addEventListener('click', unlock);
    pwdInput.addEventListener('keyup', function (e) { if (e.key === 'Enter') unlock(); });
}

/* ===========================
   Hours/Expenses form submission (Netlify)
=========================== */
const hoursForm = document.getElementById('hoursForm');
const hoursStatus = document.getElementById('hoursStatus');

if (hoursForm) {
    hoursForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        hoursStatus.textContent = 'Submitting...';
        const data = new FormData(hoursForm);
        try {
            const res = await fetch('/', { method: 'POST', body: data });
            if (res.ok) {
                hoursForm.reset();
                hoursStatus.textContent = 'Hours submitted. Thank you.';
                setTimeout(() => { window.location.href = 'thankyou.html'; }, 900);
            } else {
                hoursStatus.textContent = 'Submission error — please try again later.';
            }
        } catch (err) {
            hoursStatus.textContent = 'Network error — check connection and try again.';
        }
    });
}

