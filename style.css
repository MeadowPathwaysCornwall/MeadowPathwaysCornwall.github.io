/* ============================================================
   Meadow Pathways Script
   - Carousel
   - Active Navigation Highlight
   - Netlify Form Confirmation
   ============================================================ */

// ============ CAROUSEL / SLIDER FUNCTIONALITY ============
const slides = document.querySelectorAll('.carousel-slides img');
const dots = document.querySelectorAll('.dots button');
let currentSlide = 0;

function showSlide(index) {
  if (slides.length === 0) return;
  slides.forEach((slide, i) => {
    slide.style.display = i === index ? 'block' : 'none';
  });
  dots.forEach((dot, i) => {
    dot.classList.toggle('active', i === index);
  });
  currentSlide = index;
}

function nextSlide() {
  currentSlide = (currentSlide + 1) % slides.length;
  showSlide(currentSlide);
}

function prevSlide() {
  currentSlide = (currentSlide - 1 + slides.length) % slides.length;
  showSlide(currentSlide);
}

// Auto-slide every 5 seconds
if (slides.length > 0) {
  showSlide(currentSlide);
  setInterval(nextSlide, 5000);
}

// ============ ACTIVE NAVIGATION HIGHLIGHT ============
const navLinks = document.querySelectorAll('.sidebar ul li a');
navLinks.forEach(link => {
  if (link.href === window.location.href) {
    link.classList.add('active');
  }
});

// ============ SMOOTH SCROLL FOR INTERNAL LINKS ============
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    document.querySelector(this.getAttribute('href')).scrollIntoView({
      behavior: 'smooth'
    });
  });
});

// ============ NETLIFY FORM CONFIRMATION ============
const forms = document.querySelectorAll('form');
forms.forEach(form => {
  form.addEventListener('submit', function (e) {
    const action = form.getAttribute('action');
    const isNetlify = action && (action.includes('netlify') || form.hasAttribute('data-netlify'));

    if (isNetlify) {
      e.preventDefault();
      const formData = new FormData(form);

      fetch(form.action, {
        method: form.method,
        body: formData,
        headers: { 'Accept': 'application/json' }
      })
        .then(response => {
          if (response.ok) {
            form.reset();
            alert("✅ Thank you! Your form has been successfully submitted.");
          } else {
            alert("⚠️ There was an error submitting your form. Please try again.");
          }
        })
        .catch(() => {
          alert("⚠️ Network error — please check your connection.");
        });
    }
  });
});
